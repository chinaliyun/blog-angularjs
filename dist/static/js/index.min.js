function isMobile(){var e=navigator.userAgent.toLowerCase(),t="ipad"==e.match(/ipad/i),n="iphone os"==e.match(/iphone os/i),o="midp"==e.match(/midp/i),i="rv:1.2.3.4"==e.match(/rv:1.2.3.4/i),a="ucweb"==e.match(/ucweb/i),r="android"==e.match(/android/i),l="windows ce"==e.match(/windows ce/i),c="windows mobile"==e.match(/windows mobile/i);return!!(t||n||o||i||a||r||l||c)}"function"!=typeof Object.assign&&(Object.assign=function(e){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");e=Object(e);for(var t=1;t<arguments.length;t++){var n=arguments[t];if(null!=n)for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}),window.onload=function(){isMobile()||(document.querySelector("html").className="pc")},function(){angular.module("app",["ngCookies","ui.router"])}(),function(){function e(e,t,n,o){!function(){e.dict=o,n.get("phone")||o.go("home.login",{id:"admin.new"}),0==n.get("group")&&(e.labelControl=!0)}()}angular.module("app").controller("adminCtrl",e),e.$inject=["$scope","model","cache","dict"]}(),function(){function e(e,t,n,o){function i(){var o={id:t.params.id};n.getArticleDetail(o).then(function(t){t.ok&&(e.id=t.ok.id,e.title=t.ok.title,e.content=t.ok.content,e.labels=t.ok.labels)})}function a(){n.getLabelList().then(function(t){t.ok&&(e.labels=t.ok)})}function r(){o.confirm(e,"请输入标签名").then(function(t){if(console.log(t),t.cancel)return!1;if(""==t.ok)o.alert(e,"请输入标签名").then(function(){t.ok&&r()});else{var i={name:t.ok.trim()};n.saveLabel(i).then(function(t){t.ok?e.list.push(t.ok[0]):o.alert(e,t.err.msg)})}})}!function(){e.id="",e.showPreview=!0,e.title="",e.content="",e.labels=[],t.params.id?i():a()}(),e.togglePreview=function(){e.showPreview=!e.showPreview},e.showDetail=function(t){e.content=t.content,e.title=t.title},e.toggleLabel=function(e){e.select=!e.select},e.addLabel=function(){r()},e.fileChange=function(e){if(e.value){var t={action:"article",file:e.files[0]};n.uploadImg(t).then(function(e){})}},e.save=function(){var t={id:e.id,title:e.title,content:e.content,labels:[],action:"admin"};e.labels.map(function(e,n){e.select&&t.labels.push({id:e.id,name:e.name})}),n.saveArticle(t).then(function(t){t.ok?e.id?o.alert(e,"保存成功"):o.alert(e,"发布新文章成功").then(function(){o.go("admin.article",{id:t.ok.id})}):o.alert(e,t.err.msg).then(function(){t.err.code})})}}angular.module("app").controller("adminArticleCtrl",e),e.$inject=["$scope","$state","model","dict"]}(),function(){function e(e,t,n){function o(){t.getLabelList().then(function(t){t.ok&&(e.list=t.ok)})}!function(){e.name="",o()}(),e.addLabel=function(){if(""==e.name.trim)return console.log("标签名不能为空"),!1;var n={name:e.name.trim()};t.saveLabel(n).then(function(t){t.ok&&(e.list.push(t.ok[0]),e.name="",document.querySelector(".addLabel").focus())})},e.deleteLabel=function(n,o){var i={id:n.id};t.deleteLabel(i).then(function(t){t.ok&&e.list.splice(o,1)})}}angular.module("app").controller("adminLabelCtrl",e),e.$inject=["$scope","model","dict"]}(),function(){function e(e,t){function n(){e.search.pageNo,e.search.type;t.getArticleList(e.search).then(function(t){if(t.ok){e.list=t.ok.list,e.categoryList=t.ok.category;var n=0;t.ok.category.map(function(e,t){n+=parseInt(e.sum)}),e.labelCount=n;var n=0;t.ok.category.map(function(e,t){n+=parseInt(e.sum)}),e.articleCount=n}})}!function(){e.list=[],e.categoryList=[],e.articleCount=0,e.search={pageNo:0,type:""},n()}(),e.selectType=function(t){e.search.type=t||"",n()}}angular.module("app").controller("adminListCtrl",e),e.$inject=["$scope","model"]}(),function(){function e(e,t,n,o){!function(){e.dict=n,e.searchInput=""}(),e.logout=function(){n.clearToken(),n.cache.user_phone=""},e.search=function(t){13==t.keyCode&&""!=e.searchInput.trim()&&(e.$broadcast("searchInputChange"),t.target.blur())},e.clearSearch=function(){e.searchInput="",e.$broadcast("searchInputChange")}}angular.module("app").controller("homeCtrl",e),e.$inject=["$scope","$state","dict","model"]}(),function(){function e(e,t,n,o){function i(){var o={id:t.params.id};n.getArticleDetail(o).then(function(t){t.ok&&(e.detail=t.ok)})}!function(){t.params.id?i():o.go("home.list")}()}angular.module("app").controller("homeArticleCtrl",e),e.$inject=["$scope","$state","model","dict"]}(),function(){function e(e,t){function n(){var n={pageNo:e.search.pageNo,type:e.search.type,like:e.search.like,action:"home"};t.getArticleList(n).then(function(t){if(t.ok){e.list=t.ok.list,e.categoryList=t.ok.category;var n=0;t.ok.category.map(function(e,t){n+=parseInt(e.sum)}),e.labelCount=n,t.ok.list.length>0&&(e.search.pageNo=t.ok.list[t.ok.list.length-1].id)}else e.list=[]})}!function(){e.search={pageNo:0,type:""},e.labelCount=0,n()}(),e.$on("searchInputChange",function(){e.search.pageNo=0,e.search.like=e.searchInput,e.search.type="",n()}),e.selectType=function(t){e.search.pageNo=0,e.search.type=t||"",n()}}angular.module("app").controller("homeListCtrl",e),e.$inject=["$scope","model"]}(),function(){function e(e,t,n,o,i){!function(){e.phone="",e.passwd=""}(),e.login=function(){if(0==e.phone.trim().length)return i.alert(e,"手机号码不能为空"),!1;if(0==e.passwd.trim().length)return i.alert(e,"密码不能为空"),!1;var a={phone:e.phone,passwd:md5(e.passwd)};n.login(a).then(function(n){n.ok?(o.put("phone",n.ok.phone),o.put("usid",n.ok.usid),o.put("token",n.ok.token),o.put("u_name",n.ok.u_name),o.put("group",n.ok.group),t.params.id?i.alert(e,"欢迎回来").then(function(){i.go(t.params.id)}):i.go("home.list")):i.alert(e,n.err.msg)})}}angular.module("app").controller("homeLoginCtrl",e),e.$inject=["$scope","$state","model","cache","dict"]}(),function(){function e(e,t,n){!function(){e.phone="",e.passwd=""}(),e.register=function(){if(0==e.phone.trim().length)return n.alert(e,"手机号码不能为空"),!1;if(0==e.passwd.trim().length)return n.alert(e,"密码不能为空"),!1;if(e.passwd.length<6)return n.alert(e,"密码长度不能少于6位"),!1;if(/^\d{6,11}$/.test(e.passwd)||!/[A-Z]/.test(e.passwd))return n.alert(e,"密码过于简单"),!1;var o={phone:e.phone,passwd:md5(e.passwd)};t.register(o).then(function(t){t.ok?n.alert(e,"注册成功").then(function(){n.go("home.login")}):n.alert(e,t.err.msg)})}}angular.module("app").controller("homeRegisterCtrl",e),e.$inject=["$scope","model","dict"]}(),function(){function e(e){function t(e,t,n){}return{link:t,restrict:"EA",replace:!0,templateUrl:"./static/view/app_alert.html"}}angular.module("app").directive("appAlert",e),e.$inject=["$timeout"]}(),function(){function e(e){function t(e,t,n){!function(){e.confirmInput=""}()}return{link:t,restrict:"EA",replace:!0,templateUrl:"./static/view/app_confirm.html"}}angular.module("app").directive("appConfirm",e),e.$inject=["$timeout"]}(),function(){function e(e){function t(t){return e.get(t)}function n(t,n){e.put(t,n)}function o(t){e.remove(t)}return{get:t,put:n,remove:o}}angular.module("app").factory("cache",e),e.$inject=["$cookies"]}(),function(){function e(e,t,n,o,i,e,a){a.httpQueue=[],a.url=[],a.cache={},a.clearToken=function(){e.remove("phone"),e.remove("usid"),e.remove("token"),e.remove("u_name"),e.remove("group")},a.pageSize=["10","20","30"],a.checkToken=function(){var n=t.defer();return e.get("tokenId")?(console.log("token存在"),n.resolve()):(console.log("token不存在"),n.reject()),n.promise},a.go=function(e,t){console.log(t),t?o.go(e,t):o.go(e)},a.reload=function(){o.reload()},a.alert=function(e,n,o,a,r){e.alertVisiable=!0;var l=t.defer();return e.alertVisiable=!0,e.alertShowBtn=o||!1,e.alertOkText=a||"确定",e.alertCancelText=r||"",e.alertContext=n||"没有可以显示的内容",e.alertOk=function(){e.alertVisiable=!1,e.alertShowBtn=!1,l.resolve({ok:!0})},e.alertCancel=function(){e.alertVisiable=!1,e.alertShowBtn=!1,l.resolve({cancel:!0})},e.alertShowBtn||i(function(){e.alertOk()},1e3),l.promise},a.confirm=function(e,n,o,i,a){e.confirmVisiable=!0;var r=t.defer();return e.confirmVisiable=!0,e.confirmHeader=n||"请输入： ",e.confirmPlaceholder=o||"",e.confirmOkText=i||"确定",e.confirmCancelText=a||"取消",e.confirmOk=function(){e.confirmVisiable=!1,r.resolve({ok:e.confirmInput})},e.confirmCancel=function(){e.confirmVisiable=!1,r.resolve({cancel:!0})},r.promise},a.loading=function(e){e?($rootScope.loadingText=e,$rootScope.loading=!0):($rootScope.loadingText="",$rootScope.loading=!1)},a.verify={mobile:function(e){return/^1\d{10}$/.test(e)},email:function(e){return/^[A-Za-z0-9\u4e00-\u9fa5]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/.test(e)},url:function(e){return/(https?|ftp|file):\/\/[-A-Za-z0-9+&@#\/%?=~_|!:,.;]+[-A-Za-z0-9+&@#\/%=~_|]/.test(e)}},a.pre={}}angular.module("app").constant("dict",{}).run(e),e.$inject=["cache","$q","http","$state","$timeout","cache","dict"]}(),function(){function e(e){return function(t){return converter=new showdown.Converter,html=converter.makeHtml(t),e.trustAsHtml(html)}}angular.module("app").filter("html",e),e.$inject=["$sce"]}(),function(){"use strict";function e(e,t,n,o,i,a){function r(o,a,r,l,c){c&&i.loading(1);var u=t.defer();return e.get(a).then(function(e){c&&n(function(){i.loading()},300),console.log(o+","+a+" Res ",e.data),u.resolve(e.data)},function(e){c&&n(function(){i.loading()},300),console.log(o+","+a+", 请求失败, err: ",e),u.reject(e)}),u.promise}function l(a,r,l,c,u){u&&i.loading(1);var s=t.defer();return e({url:"http://api.codequan.com"+r,method:"POST",headers:{"Content-Type":void 0},transformRequest:function(){var e=new FormData;return angular.forEach(l,function(t,n){angular.isArray(t)?angular.forEach(t,function(t,o){e.append(n,t)}):e.append(n,t)}),e.append("token",o.get("token")),e.append("usid",o.get("usid")),e}}).then(function(e){u&&n(function(){i.loading()},300),101===e.data.code?(i.go("login"),i.clearCache(),s.reject()):(console.log(a+","+r+" Res ",e.data),s.resolve(e.data))},function(e){u&&n(function(){i.loading()},300),console.log(a+","+r+", 请求失败, err: ",e),s.reject(e)}),s.promise}function c(n,a,r,l,c){c&&(i.loading(1),i.listEmpty());var u=t.defer(),s={token:o.get("token"),usid:o.get("usid")},d={headers:{"Content-Type":"text/plain, charset=utf-8"}},p="http://api.codequan.com"+a,m=r?Object.assign({},s,r):s,f=l?Object.assign({},d,l):d;return console.log(n+" Req: ",Object.assign({},{realUrl:p},m)),e.post(p,m,f).then(function(e){if(c&&i.loading(),0!=e.data.code||void 0===e.data.data)return u.resolve({err:{code:e.data.code,msg:e.data.msg}}),console.log({err:{code:e.data.code,msg:e.data.msg}}),!1;console.log(n+" Res: ",e.data),console.log({ok:""==e.data.data||e.data.data}),u.resolve({ok:""==e.data.data||e.data.data})},function(e){c&&i.loading(),console.log(n+" Err: ",e),u.resolve({err:e})}),u.promise}return{get:r,post:c,file:l}}angular.module("app").factory("http",e),e.$inject=["$http","$q","$timeout","cache","dict","$rootScope"]}(),function(){function e(e,t){e.state("home",{url:"/home",templateUrl:"./static/view/home.html",controller:"homeCtrl"}).state("home.login",{url:"/login/:id",templateUrl:"./static/view/home_login.html",controller:"homeLoginCtrl"}).state("home.register",{url:"/register",templateUrl:"./static/view/home_register.html",controller:"homeRegisterCtrl"}).state("home.list",{url:"/list",templateUrl:"./static/view/home_list.html",controller:"homeListCtrl"}).state("home.article",{url:"/article/:id",templateUrl:"./static/view/home_article.html",controller:"homeArticleCtrl"}).state("admin",{url:"/admin",templateUrl:"./static/view/admin.html",controller:"adminCtrl"}).state("admin.new",{url:"/new",templateUrl:"./static/view/admin_article.html",controller:"adminArticleCtrl"}).state("admin.article",{url:"/article/:id",templateUrl:"./static/view/admin_article.html",controller:"adminArticleCtrl"}).state("admin.list",{url:"/list",templateUrl:"./static/view/admin_list.html",controller:"adminListCtrl"}).state("admin.label",{url:"/label",templateUrl:"./static/view/admin_label.html",controller:"adminLabelCtrl"}),t.otherwise("/home/list")}angular.module("app").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){function e(e,t,n,o){t.$on("$stateChangeSuccess",function(t){e.url.unshift(n.current.name),e.url.length>3&&e.url.splice(-1,1),o.get("phone")?(e.isLogin=!0,e.cache.user_phone=o.get("phone")):e.isLogin=!1})}angular.module("app").run(e),e.$inject=["dict","$rootScope","$state","cache"]}(),function(){function e(e){this.getArticleList=function(t){return e.post("获取文章列表","/article/article_list",t)},this.saveArticle=function(t){return e.post("保存文章","/article/save",t)},this.getArticleDetail=function(t){return e.post("获取文章详情","/article/get_detail",t)},this.getLabelList=function(t){return e.post("获取标签列表","/constant/all_label",t)},this.saveLabel=function(t){return e.post("保存标签","/constant/add_label",t)},this.deleteLabel=function(t){return e.post("删除标签","/constant/delete_label",t)},this.register=function(t){return e.post("注册账号","/user/register",t)},this.login=function(t){return e.post("用户登录","/user/login",t)},this.uploadImg=function(t){return e.file("上传图片","/upload",t)}}angular.module("app").service("model",e),e.$inject=["http"]}();